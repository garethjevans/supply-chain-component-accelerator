#@ load("@ytt:data", "data")
#@ load("@ytt:template", "template")

#@ def namespace_name(component):
name: #@ "{}-{}".format(component, data.values.build_id)
namespace: #@ data.values.namespace
#@ end

#@ def metadata(component):
_: #@ template.replace(namespace_name(component))
annotations:
  kapp.k14s.io/disable-original: ""
labels:
  supplychain.cc.build/part-of: catalog.cartographer.tanzu.vmware.com
  supplychain.cc.build/component: #@ component
  supplychain.cc.build/git-commit: #@ data.values.repo.commit
#@ end

#@ def git():
git:
  url: #@ data.values.repo.url
  ref:
    branch: #@ data.values.repo.branch
    commit: #@ data.values.repo.commit
#@ end

#@ def image(component):
#@   return "{}/{}/{}:{}".format(data.values.registry.host, data.values.registry.path, component, data.values.version)
#@ end

---
apiVersion: supplychain.cc.build/v1alpha2
kind: Request
metadata: #@ metadata("catalog-carvel")
spec:
  artifacts:
    images:
      - name: #@ image("catalog-carvel")
  buildType: kaniko
  buildConfig:
    kanikoBuildConfig:
      subPath: images/carvel
      dockerfile: Dockerfile
      extraArgs: []
  source: #@ git()
  isOfficial: #@ data.values.official
---
apiVersion: supplychain.cc.build/v1alpha2
kind: Request
metadata: #@ metadata("catalog-git")
spec:
  artifacts:
    images:
      - name: #@ image("catalog-git")
  buildType: kaniko
  buildConfig:
    kanikoBuildConfig:
      subPath: images/git
      dockerfile: Dockerfile
      extraArgs: []
  source: #@ git()
  isOfficial: #@ data.values.official
---
apiVersion: supplychain.cc.build/v1alpha2
kind: Request
metadata: #@ metadata("catalog-scripting-base")
spec:
  artifacts:
    images:
      - name: #@ image("catalog-scripting-base")
  buildType: kaniko
  buildConfig:
    kanikoBuildConfig:
      subPath: images/scripting-base
      dockerfile: Dockerfile
      extraArgs: []
  source: #@ git()
  isOfficial: #@ data.values.official
---
apiVersion: supplychain.cc.build/v1alpha2
kind: Request
metadata: #@ metadata("catalog-kubectl-kustomize")
spec:
  artifacts:
    images:
      - name: #@ image("catalog-kubectl-kustomize")
  buildType: kaniko
  buildConfig:
    kanikoBuildConfig:
      subPath: images/kubectl-kustomize
      dockerfile: Dockerfile
      extraArgs: []
  source: #@ git()
  isOfficial: #@ data.values.official
---
